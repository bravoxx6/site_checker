<!DOCTYPE html>
<html>
<head>
    <title>URL Monitoring Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; background-color: #f4f7f6; }
        .controls { margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #007bff; color: white; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-start { background-color: #28a745; color: white; }
        .btn-stop { background-color: #dc3545; color: white; }
        .status-text { font-style: italic; color: #666; }

        .status-badge { padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .INFO { color: #155724; background-color: #d4edda; }
        .WARNING { color: #856404; background-color: #fff3cd; }
        .ERROR { color: #721c24; background-color: #f8d7da; }
    </style>
</head>
<body>
    <h1>üåê –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∞–π—Ç–æ–≤</h1>

    <div class="controls">
        <button id="toggle-btn" class="btn btn-start">–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
        <span id="monitor-status" class="status-text">–°—Ç–∞—Ç—É—Å: –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
    </div>

    <table>
        <thead>
            <tr>
                <th>URL</th>
                <th>–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (—Å)</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ü–æ—Ä—Ç—ã</th>
                <th>–£—Ä–æ–≤–µ–Ω—å</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
            </tr>
        </thead>
        <tbody id="data-table">
            <tr>
                <td colspan="6" style="text-align:center;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td>
            </tr>
        </tbody>
    </table>

    <script>
        const tableBody = document.getElementById('data-table');
const toggleBtn = document.getElementById('toggle-btn');
const statusText = document.getElementById('monitor-status');

let updateInterval;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
async function updateData() {
    try {
        const response = await fetch('/api/data');
        const data = await response.json();
        
        // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏ –Ω–∞–ø–æ–ª–Ω—è–µ–º –∑–∞–Ω–æ–≤–æ
        tableBody.innerHTML = data.map(result => `
            <tr>
                <td><strong>${result.url}</strong></td>
                <td>${result.response_time || '‚Äî'}</td>
                <td>${result.status}</td>
                <td><code>${result.port_info}</code></td>
                <td>
                    <span class="status-badge ${result.status_level}">
                        ${result.status_level}
                    </span>
                </td>
                <td>${result.timestamp}</td>
            </tr>
        `).join('');
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:", err);
    }
}

// –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
toggleBtn.addEventListener('click', async () => {
    const response = await fetch('/api/toggle', { method: 'POST' });
    const state = await response.json();

    if (state.is_active) {
        // –ó–∞–ø—É—Å–∫
        toggleBtn.textContent = "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥";
        toggleBtn.className = "btn btn-stop";
        statusText.textContent = "–°—Ç–∞—Ç—É—Å: –†–∞–±–æ—Ç–∞–µ—Ç";
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        updateInterval = setInterval(updateData, 5000);
        updateData(); // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    } else {
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
        toggleBtn.textContent = "–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥";
        toggleBtn.className = "btn btn-start";
        statusText.textContent = "–°—Ç–∞—Ç—É—Å: –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω";
        clearInterval(updateInterval);
    }
});
    </script>
</body>
</html>